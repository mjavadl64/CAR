CREATE OR REPLACE PROCEDURE cherecher ( idlog MB_PERIODEPOSSIBLE.LOG_ID%TYPE, datedebut MB_PERIODEPOSSIBLE.PP_DATEDEBUT%TYPE,
										datefin MB_PERIODEPOSSIBLE.PP_DATEFIN%TYPE, iduser MB_PERIODERESERVEE.USR_ID%TYPE)
AS 
periodereserv_req MB_PERIODEPOSSIBLE%rowtype; 
BEGIN 
	
	SELECT * INTO periodereserv_req
	FROM MB_PERIODEPOSSIBLE
	WHERE MB_PERIODEPOSSIBLE.LOG_ID = idlog AND datedebut >= MB_PERIODEPOSSIBLE.PP_DATEDEBUT AND 
	datefin <= MB_PERIODEPOSSIBLE.PP_DATEFIN ;

	IF SQL%FOUND 
		THEN 
	INSERT INTO MB_PERIODERESERVEE ( pr_dateDebut , pr_dateFin,pr_prix_nuit ,LOG_ID) VALUES 
		(datedebut,datefin,(SELECT pr_prix_nuit FROM MB_PERIODERESERVEE WHERE MB_PERIODERESERVEE.LOG_ID = idlog), idlog);
	END IF ;
	END cherecher;
	
CALL cherecher(2,to_date('10-06-2024','DD-MM-YYYY'),to_date('16-06-2024','DD-MM-YYYY'),7);



SELECT 
	MB_LOGEMENT.LOG_ID , MB_LOGEMENT.LOG_ADRESSE , MB_LOGEMENT.LOG_SURFACE,
		req.PR_DATEDEBUT AS "date debut", req.PR_DATEFIN AS "date fin", req.PR_PRIX_NUIT AS "prix nuit", usr_nom
FROM 	(SELECT MB_PERIODERESERVEE.PR_DATEDEBUT, MB_PERIODERESERVEE.PR_DATEFIN, MB_PERIODERESERVEE.PR_PRIX_NUIT,MB_PERIODERESERVEE.LOG_ID,MB_UTILISATEUR.USR_NOM 
			FROM MB_PERIODERESERVEE
			INNER JOIN MB_UTILISATEUR  ON MB_UTILISATEUR.USR_ID  = MB_PERIODERESERVEE.USR_ID 
		
			UNION 
			SELECT MB_PERIODEPOSSIBLE.PP_DATEDEBUT, MB_PERIODEPOSSIBLE.PP_DATEFIN, MB_PERIODEPOSSIBLE.PP_PRIX_NUIT,MB_PERIODEPOSSIBLE.LOG_ID, 'LIBRE'
			FROM MB_PERIODEPOSSIBLE) req
INNER JOIN MB_LOGEMENT ON MB_LOGEMENT.LOG_ID  = req.log_id